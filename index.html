<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MOG Eye (PNG Mask + Blink)</title>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

video, svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* Fade-in for interactive eye */
#eyeOffset {
  opacity: 0;
  transition: opacity 0.8s ease;
}

/* Blink lid */
#blinkLid {
  transform-origin: 50% 50%;
  transform: scaleY(0);
  pointer-events: none;
}

/* Blink animation */
@keyframes blink {
  0%   { transform: scaleY(0); }
  45%  { transform: scaleY(1); }
  55%  { transform: scaleY(1); }
  100% { transform: scaleY(0); }
}
</style>
</head>

<body>

<!-- BACKGROUND VIDEO -->
<video id="bgVideo" autoplay muted playsinline>
  <source src="mog.mp4" type="video/mp4">
</video>

<svg viewBox="0 0 1920 1080">

  <defs>
    <!-- PNG MASK -->
    <mask id="eyeMask" maskUnits="userSpaceOnUse">
      <image
        href="mask.png"
        x="0"
        y="0"
        width="1920"
        height="1080"
        preserveAspectRatio="none"
      />
    </mask>
  </defs>

  <!-- INTERACTIVE EYE -->
  <g id="eyeOffset">

    <!-- SCLERA -->
    <image
      href="White.png"
      x="0"
      y="0"
      width="1920"
      height="1080"
    />

    <!-- MASKED CONTENT -->
    <g mask="url(#eyeMask)">

      <!-- IRIS (MOVES) -->
      <g id="eyeMove">
        <image
          href="Iris.png"
          x="0"
          y="0"
          width="1920"
          height="1080"
        />
      </g>

      <!-- REFLECTIONS (STATIC, ON TOP, CLIPPED) -->
      <image
        href="reflections.png"
        x="-690"
        y="-487"
        width="3090"
        height="2390"
      />

      <!-- BLINK LID -->
      <rect
        id="blinkLid"
        x="0"
        y="0"
        width="1920"
        height="1080"
        fill="black"
      />

    </g>

  </g>

</svg>

<script>
/* ==========================
   TUNING CONTROLS
   ========================== */
const BLINK_SPEED = 240;
const DOUBLE_BLINK_CHANCE = 0.3;
const DOUBLE_BLINK_DELAY = 180;
const BLINK_MIN_DELAY = 2400;
const BLINK_MAX_DELAY = 5000;

/* ==========================
   ELEMENTS
   ========================== */
const eyeMove   = document.getElementById("eyeMove");
const eyeOffset = document.getElementById("eyeOffset");
const blinkLid  = document.getElementById("blinkLid");
const video     = document.getElementById("bgVideo");

let eyeActive = false;

/* ==========================
   VIDEO TIMING
   ========================== */
video.addEventListener("timeupdate", () => {
  if (!eyeActive && video.currentTime >= 4.078) {
    video.pause();
    video.currentTime = 0;
    eyeOffset.style.opacity = "1";
    eyeActive = true;
    startBlinking();
  }
});

/* ==========================
   SHARED EYE MOVE FUNCTION
   ========================== */
function moveEye(clientX, clientY) {
  if (!eyeActive) return;

  const x = (clientX / window.innerWidth  - 0.5) * 120;
  const y = (clientY / window.innerHeight - 0.5) * 60;

  eyeMove.setAttribute("transform", `translate(${x}, ${y})`);
}

/* ==========================
   DESKTOP (MOUSE)
   ========================== */
document.addEventListener("mousemove", (e) => {
  moveEye(e.clientX, e.clientY);
});

/* ==========================
   MOBILE (TOUCH)
   ========================== */
document.addEventListener("touchstart", (e) => {
  if (e.touches.length > 0) {
    moveEye(e.touches[0].clientX, e.touches[0].clientY);
  }
}, { passive: true });

document.addEventListener("touchmove", (e) => {
  if (e.touches.length > 0) {
    moveEye(e.touches[0].clientX, e.touches[0].clientY);
  }
}, { passive: true });

/* ==========================
   BLINK LOGIC
   ========================== */
function blinkOnce() {
  blinkLid.style.animation = `blink ${BLINK_SPEED}ms ease-in-out`;
  blinkLid.addEventListener("animationend", () => {
    blinkLid.style.animation = "";
  }, { once: true });
}

function blink() {
  blinkOnce();
  if (Math.random() < DOUBLE_BLINK_CHANCE) {
    setTimeout(blinkOnce, DOUBLE_BLINK_DELAY);
  }
}

function startBlinking() {
  (function loop() {
    blink();
    const delay =
      BLINK_MIN_DELAY +
      Math.random() * (BLINK_MAX_DELAY - BLINK_MIN_DELAY);
    setTimeout(loop, delay);
  })();
}
</script>

</body>
</html>
